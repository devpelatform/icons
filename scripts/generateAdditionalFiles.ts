import { spawn } from 'child_process';
import { join } from 'path';

interface ScriptResult {
  name: string;
  success: boolean;
  error?: string;
}

function runScript(
  scriptPath: string,
  scriptName: string,
): Promise<ScriptResult> {
  return new Promise((resolve) => {
    console.log(`üöÄ Running ${scriptName}...`);

    const child = spawn('tsx', [scriptPath], {
      stdio: 'inherit',
      shell: true,
    });

    child.on('close', (code) => {
      if (code === 0) {
        console.log(`‚úÖ ${scriptName} completed successfully`);
        resolve({ name: scriptName, success: true });
      } else {
        const error = `${scriptName} failed with exit code ${code}`;
        console.error(`‚ùå ${error}`);
        resolve({ name: scriptName, success: false, error });
      }
    });

    child.on('error', (error) => {
      const errorMsg = `${scriptName} failed to start: ${error.message}`;
      console.error(`‚ùå ${errorMsg}`);
      resolve({ name: scriptName, success: false, error: errorMsg });
    });
  });
}

async function generateAdditionalFiles(): Promise<void> {
  console.log('üöÄ Starting additional files generation...');
  console.log(
    'üìÇ Generating aliases, dynamic imports, and icon list files...\n',
  );

  const scripts = [
    { path: join('scripts', 'generateAliases.ts'), name: 'Aliases Generator' },
    {
      path: join('scripts', 'generateDynamicImports.ts'),
      name: 'Dynamic Imports Generator',
    },
    {
      path: join('scripts', 'generateIconList.ts'),
      name: 'Icon List Generator',
    },
  ];

  const results: ScriptResult[] = [];

  // Run scripts sequentially
  for (const script of scripts) {
    const result = await runScript(script.path, script.name);
    results.push(result);
    console.log(''); // Add spacing between scripts
  }

  // Summary
  console.log('üìã Generation Summary:');
  const successful = results.filter((r) => r.success);
  const failed = results.filter((r) => !r.success);

  console.log(`‚úÖ Successful: ${successful.length}/${results.length}`);
  successful.forEach((result) => {
    console.log(`   ‚úì ${result.name}`);
  });

  if (failed.length > 0) {
    console.log(`‚ùå Failed: ${failed.length}/${results.length}`);
    failed.forEach((result) => {
      console.log(`   ‚úó ${result.name}: ${result.error}`);
    });
  }

  if (failed.length > 0) {
    console.log('\n‚ùå Some generators failed. Please check the errors above.');
    process.exit(1);
  } else {
    console.log('\n‚úÖ All additional files generated successfully!');
    console.log('üìÇ Generated files:');
    console.log('   - src/aliases.ts');
    console.log('   - src/dynamic-imports.ts');
    console.log('   - src/icon-list.ts');
  }
}

// Run the script
generateAdditionalFiles().catch((error) => {
  console.error('‚ùå Unexpected error:', error);
  process.exit(1);
});
